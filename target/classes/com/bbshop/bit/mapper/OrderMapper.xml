<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bbshop.bit.mapper.OrderMapper">

	<resultMap type="com.bbshop.bit.domain.Cart_PDVO"
		id="CartResultMap">
		<result property="GOODS_NUM" column="GOODS_NUM" />
		<result property="PRICE" column="PRICE" />
		<result property="QNTTY" column="QNTTY" />
		<result property="GD_CT_KEY" column="GD_CT_KEY" />
		<result property="SAVINGS" column="SAVINGS" />
		<result property="STOCK" column="STOCK" />
		<result property="GD_DETAILS" column="GD_DETAILS" />
		<result property="USER_KEY" column="USER_KEY" />
	</resultMap>

	<select id="getCheckedCartList" resultMap="CartResultMap">
		SELECT *
		FROM cart_gd
		WHERE
		goods_num IN
		<foreach collection="array" item="goods_num" open="(" close=")" separator=",">
		#{goods_num}
		</foreach> 
	</select>
	
	<select id="getOptionListGlove" resultType = "com.bbshop.bit.domain.Gd_GloveVO">
		SELECT *
		FROM gd_glove
		WHERE glove_num = #{GD_DETAILS}
	</select>
	
	<select id="getOptionListBat">
		SELECT *
		FROM gd_bat
		WHERE bat_num = #{GD_DETAILS}
	</select>
	
	<select id="getOptionListUniform">
		SELECT *
		FROM gd_uniform
		WHERE uniform_num = #{GD_DETAILS}
	</select>
	
	<select id="getOptionListShoes">
		SELECT *
		FROM gd_shoes
		WHERE shoes_num = #{GD_DETAILS}
	</select>
	
	<select id="getOptionListBall">
		SELECT *
		FROM gd_ball
		WHERE ball_num = #{GD_DETAILS}
	</select>
	
	<insert id="insertOrder" parameterType="com.bbshop.bit.domain.OrderVO">
		<selectKey keyProperty="order_num" resultType="int"
			order="BEFORE">
			select seq_order.nextval FROM DUAL
		</selectKey>
		INSERT INTO shop_order(order_num, user_key, pymntamnt, savings, or_addr, receiver, phone1, phone2, or_msg, name, or_date, stts, pymntmthd, cancel)
		VALUES(#{order_num}, #{user_key}, #{pymntamnt}, #{savings}, #{or_addr}, #{receiver}, #{phone1}, #{phone2}, #{or_msg}, #{name}, sysdate, 0, 'kakaoPay', 0)
	</insert>
	
	<select id="getLastOrderNum" resultType="com.bbshop.bit.domain.OrderVO">
	SELECT order_num 
	FROM
    	(SELECT * 
    	FROM shop_order 
    	ORDER BY or_date DESC)
    WHERE user_key = {user_key} and rownum = 1;
	</select>

</mapper>